<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Генерация по PDF/URL</title>
  <style>
    body { font-family:"Inter",sans-serif; background:#f8f9fa; margin:0; padding:40px; max-width:800px; margin:auto; }
    h1 { color:#f47936; }
    form { background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); }
    input, button { width:100%; padding:12px; margin-bottom:15px; font-size:16px; border-radius:8px; border:1px solid #ddd; }
    button { background:#f47936; color:white; border:none; cursor:pointer; }
    button:hover { background:#d6520b; }
    #loader { display:none; text-align:center; margin:30px 0; }
    #hypotheses-container { display:none; margin-top:30px; background:#fff; padding:25px; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.08); }
    pre { background:#f8f9fa; padding:20px; border-radius:8px; white-space:pre-wrap; font-size:16px; line-height:1.6; }
    .back { margin-top:30px; color:#f47936; display:block; }
    .error { color:#d6520b; font-weight:bold; }
  </style>
</head>
<body>
  <!-- Flash-сообщения -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div style="padding:15px; margin:20px auto; max-width:700px; border-radius:8px; text-align:center; border:1px solid; {% if category == 'error' %}background:#f8d7da;color:#721c24;border-color:#f5c6cb;{% elif category == 'success' %}background:#d4edda;color:#155724;border-color:#c3e6cb;{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h1>Генерация гипотез из файла или ссылки</h1>

  <form id="custom-form" enctype="multipart/form-data">
    <input type="url" name="url" id="url" placeholder="Вставьте ссылку на статью">
    <input type="file" name="file" id="file" accept=".pdf">
    <button type="submit" id="submit-btn">Генерировать гипотезы</button>
  </form>

  <div id="loader">
    <img src="https://i.gifer.com/origin/34/34338d26023e5515f6cc8969aa027bca_w200.gif" alt="Загрузка" width="80">
    <p style="color:#f47936;">Генерация гипотез...</p>
  </div>

  <div id="hypotheses-container">
    <h3>Сгенерированные гипотезы</h3>
    <pre id="hypotheses-text"></pre>
  </div>

  <a href="/" class="back">← Назад к списку</a>

  <script>
    document.getElementById('custom-form').addEventListener('submit', async function(e) {
      e.preventDefault();  // Отменяем обычную отправку формы

      const form = this;
      const formData = new FormData(form);
      const btn = document.getElementById('submit-btn');
      const loader = document.getElementById('loader');
      const container = document.getElementById('hypotheses-container');
      const textArea = document.getElementById('hypotheses-text');

      btn.disabled = true;
      btn.textContent = 'Генерация...';
      loader.style.display = 'block';
      container.style.display = 'none';
      textArea.textContent = '';

      try {
        const response = await fetch('/custom_generate', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();

        if (data.success) {
          textArea.textContent = data.hypotheses;
        } else {
          textArea.textContent = 'Ошибка: ' + (data.error || 'Неизвестная ошибка');
          textArea.classList.add('error');
        }
        container.style.display = 'block';
      } catch (error) {
        textArea.textContent = 'Ошибка сети: ' + error.message;
        textArea.classList.add('error');
        container.style.display = 'block';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Генерировать гипотезы';
        loader.style.display = 'none';
      }
    });
  </script>
</body>
</html>
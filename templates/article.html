<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ article.title }}</title>
  <style>
    body { font-family:"Inter",sans-serif; background:#f8f9fa; margin:0; padding:40px; max-width:1000px; margin:auto; line-height:1.7; }
    h1 { color:#f47936; margin-bottom:15px; }
    .meta { color:#555; margin:15px 0; font-size:16px; }
    .abstract, .translated { font-size:17px; color:#333; white-space:pre-wrap; background:#fff; padding:25px; border-radius:12px; margin-bottom:25px; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
    .translated { background:#fffaf0; border-left:5px solid #f47936; }
    .btn { background:#f47936; color:white; padding:14px 24px; border:none; border-radius:10px; font-size:17px; cursor:pointer; margin:10px 10px 10px 0; display:inline-block; text-decoration:none; }
    .btn:hover { background:#d6520b; }
    .no-pdf { color:#d6520b; font-weight:bold; margin:15px 0; font-size:16px; }
    .back { margin-top:40px; display:block; color:#f47936; font-size:16px; }
    #loader { display:none; text-align:center; margin:40px 0; }
    #hypotheses-container { display:none; margin-top:30px; background:#fff; padding:25px; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.08); }
    pre { background:#f8f9fa; padding:20px; border-radius:8px; white-space:pre-wrap; font-size:16px; line-height:1.6; }
  </style>
</head>
<body>
  <!-- Flash-сообщения -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div style="padding:15px; margin:20px auto; max-width:700px; border-radius:8px; text-align:center; border:1px solid; {% if category == 'error' %}background:#f8d7da;color:#721c24;border-color:#f5c6cb;{% elif category == 'success' %}background:#d4edda;color:#155724;border-color:#c3e6cb;{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <h1>{{ article.title }}</h1>
  <div class="meta">Авторы: {{ article.authors or "Не указаны" }} · {{ article.source }}</div>

  <div class="abstract">
    <strong>Аннотация (оригинал):</strong><br><br>
    {{ article.abstract or "Аннотация отсутствует" }}
  </div>

  {% if translated and translated != article.abstract %}
  <div class="translated">
    <strong>Автоматический перевод на русский:</strong><br><br>
    {{ translated }}
  </div>
  {% endif %}

  {% if article.pdf_url != "#" %}
    <a href="{{ article.pdf_url }}" target="_blank" class="btn">Открыть оригинал (PDF)</a>
  {% else %}
    <p class="no-pdf">Открытый PDF недоступен</p>
  {% endif %}

  <button id="generate-btn" class="btn">Сгенерировать 3 гипотезы</button>

  <div id="loader">
    <img src="https://i.gifer.com/origin/34/34338d26023e5515f6cc8969aa027bca_w200.gif" alt="Загрузка" width="80">
    <p style="color:#f47936;">Генерация гипотез...</p>
  </div>

  <div id="hypotheses-container">
    <h3>Сгенерированные гипотезы</h3>
    <pre id="hypotheses-text"></pre>
  </div>

  <a href="/" class="back">← Назад к списку</a>

<script>
  document.getElementById('generate-btn').addEventListener('click', async function() {
    const btn = this;
    const loader = document.getElementById('loader');
    const container = document.getElementById('hypotheses-container');
    const textArea = document.getElementById('hypotheses-text');

    btn.disabled = true;
    btn.textContent = 'Генерация...';
    loader.style.display = 'block';
    container.style.display = 'none';
    textArea.textContent = '';

    try {
      const response = await fetch('/generate/{{ article.id }}');
      const data = await response.json();

      if (data.success) {
        textArea.textContent = data.hypotheses;
      } else {
        textArea.textContent = 'Ошибка: ' + (data.error || 'Неизвестная ошибка сервера');
      }
      container.style.display = 'block';
    } catch (error) {
      textArea.textContent = 'Ошибка сети: ' + error.message;
      container.style.display = 'block';
    } finally {
      btn.disabled = false;
      btn.textContent = 'Сгенерировать 3 гипотезы';
      loader.style.display = 'none';
    }
  });
</script>
</body>
</html>